<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Volleyball Team Manager</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; background-color: #f0f2f5; }
    .container { max-width: 1400px; margin: auto; padding: 20px; }
    h1 { color: #1a3c34; text-align: center; }
    .team-section, .game-section, .stats-section, .inventory-section { background: white; border-radius: 8px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    .dropdown-container { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 20px; }
    .dropdown { flex: 1; min-width: 200px; }
    select, input, button { padding: 8px; border-radius: 4px; border: 1px solid #ccc; }
    button { background: #1a3c34; color: white; cursor: pointer; transition: background 0.3s; }
    button:hover { background: #14524a; }
    button:disabled { background: #cccccc; cursor: not-allowed; }
    #courtCanvas { border: 1px solid #000; background: #e0f7fa; display: block; margin: auto; }
    .player-img { width: 25px; height: 25px; border-radius: 50%; margin-right: 5px; }
    .position-zone { fill: rgba(0,0,0,0.1); }
    @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }
    .animating { animation: bounce 0.5s infinite; }
    .game-controls { display: flex; gap: 10px; justify-content: center; margin-top: 10px; }
    .stats-section { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; }
    .stat-card { background: #f9f9f9; padding: 10px; border-radius: 4px; text-align: center; }
    .inventory-section { max-height: 200px; overflow-y: auto; }
    .inventory-item { display: flex; justify-content: space-between; align-items: center; padding: 5px; border-bottom: 1px solid #eee; }
    .pack-buttons { display: flex; gap: 10px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Volleyball Team Manager</h1>
    <p>Team Points: <span id="points">0</span> | Currency: $<span id="currency">1000</span></p>
    
    <div class="team-section">
      <h2>Team Setup</h2>
      <p>Team Name: <input type="text" id="teamName" placeholder="Enter team name"></p>
      <button onclick="saveTeamName()">Save Team Name</button>
      <h3>Select Players for Positions</h3>
      <div class="dropdown-container">
        <div class="dropdown">
          <label>Position 1 (Back Right):</label>
          <select id="pos1" onchange="updateLineup('pos1', this.value)"></select>
        </div>
        <div class="dropdown">
          <label>Position 2 (Front Right):</label>
          <select id="pos2" onchange="updateLineup('pos2', this.value)"></select>
        </div>
        <div class="dropdown">
          <label>Position 3 (Front Center):</label>
          <select id="pos3" onchange="updateLineup('pos3', this.value)"></select>
        </div>
        <div class="dropdown">
          <label>Position 4 (Front Left):</label>
          <select id="pos4" onchange="updateLineup('pos4', this.value)"></select>
        </div>
        <div class="dropdown">
          <label>Position 5 (Back Left):</label>
          <select id="pos5" onchange="updateLineup('pos5', this.value)"></select>
        </div>
        <div class="dropdown">
          <label>Position 6 (Back Center):</label>
          <select id="pos6" onchange="updateLineup('pos6', this.value)"></select>
        </div>
      </div>
      <h3>Add Players</h3>
      <div class="pack-buttons">
        <button onclick="openPack('vnl_men', 100)">VNL Men ($100)</button>
        <button onclick="openPack('vnl_women', 100)">VNL Women ($100)</button>
        <button onclick="openPack('volleyroo_men', 80)">Volleyroo Men ($80)</button>
        <button onclick="openPack('volleyroo_women', 80)">Volleyroo Women ($80)</button>
        <button onclick="openPack('iran_men', 90)">Iran Men ($90)</button>
        <button onclick="openPack('china_men', 90)">China Men ($90)</button>
        <button onclick="openPack('china_women', 90)">China Women ($90)</button>
        <button onclick="openPack('japan_men', 95)">Japan Men ($95)</button>
        <button onclick="openPack('japan_women', 95)">Japan Women ($95)</button>
      </div>
      <div id="packResult"></div>
    </div>

    <div class="inventory-section">
      <h2>Your Players</h2>
      <div id="playerInventory"></div>
    </div>

    <div class="game-section">
      <h2>Play Game</h2>
      <div class="game-controls">
        <select id="opponent">
          <option value="random">Random Team</option>
        </select>
        <button id="startMatchBtn" onclick="playGame()">Start Match</button>
        <button id="rotateTeamBtn" onclick="rotateTeam()">Rotate Team</button>
      </div>
      <div id="gameResult"></div>
      <canvas id="courtCanvas" width="800" height="400"></canvas>
    </div>

    <div class="stats-section">
      <h2>Team Stats</h2>
      <div id="teamStats"></div>
    </div>
  </div>

  <script>
    const playerPacks = {
      vnl_men: [
        { name: "Karch Kiraly", position: "Outside Hitter", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/1000.webp" },
        { name: "Wilfredo Leon", position: "Outside Hitter", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/152916.webp" },
        { name: "Bruno Rezende", position: "Setter", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/108577.webp" },
        { name: "Robertlandy Simon", position: "Middle Blocker", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/108372.webp" },
        { name: "Facundo Conte", position: "Outside Hitter", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/124733.webp" },
        { name: "Mateusz Bieniek", position: "Middle Blocker", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/143784.webp" },
        { name: "Earvin Ngapeth", position: "Outside Hitter", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/131433.webp" },
        { name: "Matthew Anderson", position: "Opposite", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/116757.webp" },
        { name: "Maxwell Holt", position: "Middle Blocker", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/116761.webp" },
        { name: "Micah Christenson", position: "Setter", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/136879.webp" },
      ],
      vnl_women: [
        { name: "Zhu Ting", position: "Outside Hitter", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/138722.webp" },
        { name: "Tijana Boskovic", position: "Opposite", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/138318.webp" },
        { name: "Monica De Gennaro", position: "Libero", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/113733.webp" },
        { name: "Eda Erdem", position: "Middle Blocker", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/113058.webp" },
        { name: "Paola Egonu", position: "Opposite", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/141071.webp" },
        { name: "Jordan Larson", position: "Outside Hitter", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/116756.webp" },
        { name: "Kelsey Robinson", position: "Outside Hitter", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/134541.webp" },
        { name: "Jordyn Poulter", position: "Setter", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/151533.webp" },
        { name: "Anna Danesi", position: "Middle Blocker", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/141070.webp" },
        { name: "Stella Nervini", position: "Outside Hitter", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/183093.webp" },
        { name: "Alessia Orro", position: "Setter", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/141069.webp" },
        { name: "Sarah Luisa Fahr", position: "Middle Blocker", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/156594.webp" },
        { name: "Ekaterina Antropova", position: "Opposite", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/171296.webp" },
        { name: "Myriam Fatime Sylla", position: "Outside Hitter", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/156593.webp" },
        { name: "Julia Isabelle Bergmann", position: "Outside Hitter", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/177533.webp" },
        { name: "Roberta Silva Ratzke", position: "Setter", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/149946.webp" },
        { name: "Gabi Guimaraes", position: "Outside Hitter", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/138317.webp" },
      ],
      volleyroo_men: [
        { name: "Lorenzo Pope", position: "Outside Hitter", photo: "https://volleyball.org.au/wp-content/uploads/2023/08/Lorenzo-Pope-Volleyroos-Profile.jpg" },
        { name: "Jackson Holland", position: "Libero", photo: "https://volleyball.org.au/wp-content/uploads/2023/08/Jackson-Holland-Volleyroos-Profile.jpg" },
        { name: "Trent O'Dea", position: "Middle Blocker", photo: "https://volleyball.org.au/wp-content/uploads/2023/08/Trent-ODay-Volleyroos-Profile.jpg" },
        { name: "Matthew Aubrey", position: "Opposite", photo: "https://volleyball.org.au/wp-content/uploads/2023/08/Matthew-Aubrey-Volleyroos-Profile.jpg" },
        { name: "Sam Flowerday", position: "Outside Hitter", photo: "https://volleyball.org.au/wp-content/uploads/2023/08/Sam-Flowerday-Volleyroos-Profile.jpg" },
        { name: "Thomas Heptinstall", position: "Outside Hitter", photo: "https://volleyball.org.au/wp-content/uploads/2023/08/Thomas-Heptinstall-Volleyroos-Profile.jpg" },
        { name: "Mitchell Croft", position: "Outside Hitter", photo: "https://volleyball.org.au/wp-content/uploads/2023/08/Mitchell-Croft-Volleyroos-Profile.jpg" },
        { name: "Joel McGruther", position: "Middle Blocker", photo: "https://volleyball.org.au/wp-content/uploads/2023/08/Joel-McGruther-Volleyroos-Profile.jpg" },
        { name: "William D'Arcy-Miles", position: "Opposite", photo: "https://volleyball.org.au/wp-content/uploads/2023/08/William-DArcy-Miles-Volleyroos-Profile.jpg" },
        { name: "Nicholas Butler", position: "Setter", photo: "https://volleyball.org.au/wp-content/uploads/2023/08/Nicholas-Butler-Volleyroos-Profile.jpg" },
        { name: "Timothy Ebbs", position: "Libero", photo: "https://volleyball.org.au/wp-content/uploads/2023/08/Timothy-Ebbs-Volleyroos-Profile.jpg" },
        { name: "Jarvis Page", position: "Setter", photo: "https://volleyball.org.au/wp-content/uploads/2023/08/Jarvis-Page-Volleyroos-Profile.jpg" },
        { name: "Max Senica", position: "Outside Hitter", photo: "https://volleyball.org.au/wp-content/uploads/2023/08/Max-Senica-Volleyroos-Profile.jpg" },
        { name: "Steven Yarad", position: "Middle Blocker", photo: "https://volleyball.org.au/wp-content/uploads/2023/08/Steven-Yarad-Volleyroos-Profile.jpg" },
      ],
      volleyroo_women: [
        { name: "Mikaela Stevens", position: "Setter", photo: "https://volleyball.org.au/wp-content/uploads/2023/08/Mikaela-Stevens-Volleyroos-Profile.jpg" },
        { name: "Caitlin Tipping", position: "Outside Hitter", photo: "https://volleyball.org.au/wp-content/uploads/2023/08/Caitlin-Tipping-Volleyroos-Profile.jpg" },
        { name: "Alexia Zammit", position: "Setter", photo: "https://volleyball.org.au/wp-content/uploads/2023/08/Alexia-Zammit-Volleyroos-Profile.jpg" },
        { name: "Allysha Sims", position: "Libero", photo: "https://volleyball.org.au/wp-content/uploads/2023/08/Allysha-Sims-Volleyroos-Profile.jpg" },
        { name: "Emma Burton", position: "Opposite", photo: "https://volleyball.org.au/wp-content/uploads/2023/08/Emma-Burton-Volleyroos-Profile.jpg" },
        { name: "Cassandra Dodd", position: "Middle Blocker", photo: "https://volleyball.org.au/wp-content/uploads/2023/08/Cassandra-Dodd-Volleyroos-Profile.jpg" },
        { name: "Lauren Cox", position: "Middle Blocker", photo: "https://volleyball.org.au/wp-content/uploads/2023/08/Lauren-Cox-Volleyroos-Profile.jpg" },
        { name: "Caitlin Whincup", position: "Outside Hitter", photo: "https://volleyball.org.au/wp-content/uploads/2023/08/Caitlin-Whincup-Volleyroos-Profile.jpg" },
        { name: "Kasey Hogan", position: "Outside Hitter", photo: "https://volleyball.org.au/wp-content/uploads/2023/08/Kasey-Hogan-Volleyroos-Profile.jpg" },
        { name: "Cameron Zajer", position: "Outside Hitter", photo: "https://volleyball.org.au/wp-content/uploads/2023/08/Cameron-Zajer-Volleyroos-Profile.jpg" },
        { name: "Sarah Burton", position: "Libero", photo: "https://volleyball.org.au/wp-content/uploads/2023/08/Sarah-Burton-Volleyroos-Profile.jpg" },
        { name: "Ella Schabort", position: "Outside Hitter", photo: "https://volleyball.org.au/wp-content/uploads/2023/08/Ella-Schabort-Volleyroos-Profile.jpg" },
        { name: "Kara Inskip", position: "Middle Blocker", photo: "https://volleyball.org.au/wp-content/uploads/2023/08/Kara-Inskip-Volleyroos-Profile.jpg" },
        { name: "Elysse Hislop", position: "Middle Blocker", photo: "https://volleyball.org.au/wp-content/uploads/2023/08/Elysse-Hislop-Volleyroos-Profile.jpg" },
      ],
      iran_men: [
        { name: "Arshia Beh-nezhad", position: "Outside Hitter", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/172974.webp" },
        { name: "Ali Haaji-pour", position: "Outside Hitter", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/175796.webp" },
        { name: "Ali Ramezani", position: "Middle Blocker", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/175797.webp" },
        { name: "Neema Baateni", position: "Middle Blocker", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/183086.webp" },
        { name: "Morteza Sharifi", position: "Opposite", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/149953.webp" },
        { name: "Pouriya Hossein-Khaanzadeh", position: "Setter", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/149950.webp" },
        { name: "Ameen Esmaeil-Nezhaad", position: "Middle Blocker", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/149951.webp" },
        { name: "Bardiya Sa'adat", position: "Middle Blocker", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/175795.webp" },
        { name: "Arman Salehi", position: "Libero", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/183087.webp" },
        { name: "Amir Hossein Essfandiyar", position: "Opposite", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/149952.webp" },
        { name: "Mohammad Reza Hazrat-pour", position: "Setter", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/152915.webp" },
        { name: "Ali Haq-parast", position: "Outside Hitter", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/175798.webp" },
        { name: "Javad Karimi", position: "Middle Blocker", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/149954.webp" },
        { name: "Seyed Eessa Nasseri", position: "Outside Hitter", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/183088.webp" },
        { name: "Yussuf Kazemi", position: "Opposite", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/183089.webp" },
        { name: "Mateen Ahmadi", position: "Middle Blocker", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/183090.webp" },
        { name: "Ehsan Daanesh-Doost", position: "Outside Hitter", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/183091.webp" },
        { name: "Mohammad Vali-Zadeh", position: "Middle Blocker", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/183092.webp" },
      ],
      china_men: [
        { name: "Jiang Chuan", position: "Opposite", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/136877.webp" },
        { name: "Wen Zihua", position: "Opposite", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/172975.webp" },
        { name: "Wang Hebin", position: "Setter", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/175799.webp" },
        { name: "Yu Yuantai", position: "Outside Hitter", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/149947.webp" },
        { name: "Yu Yaochen", position: "Middle Blocker", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/172976.webp" },
        { name: "Li Yongzhen", position: "Middle Blocker", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/175800.webp" },
        { name: "Ji Daoshuai", position: "Outside Hitter", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/136876.webp" },
        { name: "Zhang Zhejia", position: "Middle Blocker", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/149944.webp" },
        { name: "Zhai Dejun", position: "Outside Hitter", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/149945.webp" },
        { name: "Peng Shikun", position: "Middle Blocker", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/172977.webp" },
        { name: "Qu Zongshuai", position: "Libero", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/175801.webp" },
        { name: "Rao Shuhan", position: "Middle Blocker", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/172978.webp" },
        { name: "Miao Ruantong", position: "Middle Blocker", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/172979.webp" },
        { name: "Zhang Jingyin", position: "Outside Hitter", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/149943.webp" },
        { name: "Wang Bin", position: "Outside Hitter", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/172980.webp" },
        { name: "Li Tianyue", position: "Libero", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/175802.webp" },
      ],
      china_women: [
        { name: "Yuan Xinyue", position: "Middle Blocker", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/138721.webp" },
        { name: "Zhu Ting", position: "Outside Hitter", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/138722.webp" },
        { name: "Diao Linyu", position: "Setter", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/149948.webp" },
        { name: "Gao Yi", position: "Middle Blocker", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/172981.webp" },
        { name: "Gong Xiangyu", position: "Opposite", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/149949.webp" },
        { name: "Wang Yuanyuan", position: "Middle Blocker", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/149947.webp" },
        { name: "Zhang Changning", position: "Outside Hitter", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/132308.webp" },
        { name: "Li Yingying", position: "Outside Hitter", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/149946.webp" },
        { name: "Zheng Yixin", position: "Opposite", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/149945.webp" },
        { name: "Ding Xia", position: "Setter", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/132307.webp" },
        { name: "Wang Mengjie", position: "Libero", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/149944.webp" },
        { name: "Wu Mengjie", position: "Outside Hitter", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/172982.webp" },
        { name: "Zhuang Yushan", position: "Outside Hitter", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/172983.webp" },
      ],
      japan_men: [
        { name: "Yuji Nishida", position: "Opposite", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/152914.webp" },
        { name: "Taishi Onodera", position: "Middle Blocker", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/136874.webp" },
        { name: "Hideomi Fukatsu", position: "Setter", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/113056.webp" },
        { name: "Kento Miyaura", position: "Opposite", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/152913.webp" },
        { name: "Tatsunori Otsuka", position: "Outside Hitter", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/149942.webp" },
        { name: "Akihiro Yamauchi", position: "Middle Blocker", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/113057.webp" },
        { name: "Yudai Arai", position: "Outside Hitter", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/149941.webp" },
        { name: "Masahiro Sekita", position: "Setter", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/136873.webp" },
        { name: "Masaki Oya", position: "Setter", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/149940.webp" },
        { name: "Kentaro Takahashi", position: "Middle Blocker", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/149939.webp" },
        { name: "Shoma Tomita", position: "Outside Hitter", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/149938.webp" },
        { name: "Ran Takahashi", position: "Outside Hitter", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/149937.webp" },
        { name: "Tomohiro Ogawa", position: "Libero", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/149936.webp" },
        { name: "Yūki Ishikawa", position: "Outside Hitter", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/136872.webp" },
        { name: "Masato Kai", position: "Outside Hitter", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/149935.webp" },
        { name: "Go Murayama", position: "Middle Blocker", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/172984.webp" },
        { name: "Keigo Nishimoto", position: "Middle Blocker", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/172985.webp" },
        { name: "Hiroto Nishiyama", position: "Opposite", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/172986.webp" },
        { name: "Kazuyuki Takahashi", position: "Libero", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/172987.webp" },
        { name: "Tomohiro Yamamoto", position: "Libero", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/149934.webp" },
        { name: "Motoki Eiro", position: "Setter", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/172988.webp" },
        { name: "Soshi Fujinaka", position: "Libero", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/172989.webp" },
        { name: "Larry Evbade-Dan", position: "Middle Blocker", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/172990.webp" },
        { name: "Keihan Takahashi", position: "Opposite", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/172991.webp" },
        { name: "Ryo Shimokawa", position: "Setter", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/172992.webp" },
        { name: "Akito Yamazaki", position: "Outside Hitter", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/172993.webp" },
        { name: "Yuga Tarumi", position: "Outside Hitter", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/172994.webp" },
        { name: "Kento Asano", position: "Middle Blocker", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/173010.webp" },
        { name: "Hiromasa Miwa", position: "Middle Blocker", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/173011.webp" },
        { name: "Keitaro Nishikawa", position: "Middle Blocker", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/173005.webp" },
        { name: "Yuki Imahashi", position: "Setter", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/173006.webp" },
        { name: "Shunichiro Sato", position: "Middle Blocker", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/173007.webp" },
        { name: "Keishiro Takaki", position: "Libero", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/173008.webp" },
        { name: "Rikuto Goto", position: "Outside Hitter", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/173009.webp" },
        { name: "Yuji Kudo", position: "Outside Hitter", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/172995.webp" },
        { name: "Taito Mizumachi", position: "Outside Hitter", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/172996.webp" },
        { name: "Riku Ito", position: "Middle Blocker", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/172997.webp" },
        { name: "Daiki Yamada", position: "Opposite", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/172998.webp" },
        { name: "Hiroaki Maki", position: "Opposite", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/172999.webp" },
        { name: "Kaisyu Takematsu", position: "Setter", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/173000.webp" },
        { name: "Takuma Kawano", position: "Outside Hitter", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/173001.webp" },
        { name: "Aiki Mori", position: "Libero", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/173002.webp" },
        { name: "Kosuke Yasui", position: "Outside Hitter", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/173003.webp" },
        { name: "Ryu Yamamoto", position: "Setter", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/173004.webp" },
      ],
      japan_women: [
        { name: "Ayaka Araki", position: "Middle Blocker", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/149933.webp" },
        { name: "Haruyo Shimamura", position: "Middle Blocker", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/113055.webp" },
        { name: "Mayu Ishikawa", position: "Outside Hitter", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/149932.webp" },
        { name: "Nanami Seki", position: "Setter", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/149931.webp" },
        { name: "Manami Kojima", position: "Libero", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/149930.webp" },
        { name: "Nichika Yamada", position: "Middle Blocker", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/149929.webp" },
        { name: "Satomi Fukudome", position: "Libero", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/149928.webp" },
        { name: "Yukiko Wada", position: "Outside Hitter", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/149927.webp" },
        { name: "Airi Miyabe", position: "Middle Blocker", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/149926.webp" },
        { name: "Miiku Iwasawa", position: "Outside Hitter", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/149925.webp" },
        { name: "Tsukasa Nakagawa", position: "Setter", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/149924.webp" },
        { name: "Yoshino Sato", position: "Outside Hitter", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/149923.webp" },
        { name: "Ayane Kitamado", position: "Outside Hitter", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/173012.webp" },
        { name: "Miku Akimoto", position: "Outside Hitter", photo: "https://img.volleyballworld.com/image-upload/t_headshotSportCut/f_png/vbld/webp/Players/173013.webp" },
      ],
    };

    // Game state
    let team = { 
      name: "My Team", 
      players: [], 
      points: 0, 
      currency: 1000,
      stats: { matches: 0, wins: 0, setsWon: 0, kills: 0, blocks: 0, aces: 0, digs: 0, errors: 0 } 
    };
    let lineup = {};
    let currentRotation = 0;
    const lineupPositions = {
      pos1: {x: 650, y: 300, label: 'Position 1 (Back Right)'}, // Serving position
      pos2: {x: 550, y: 100, label: 'Position 2 (Front Right)'}, // Outside hitter
      pos3: {x: 450, y: 100, label: 'Position 3 (Front Center)'}, // Middle blocker
      pos4: {x: 350, y: 100, label: 'Position 4 (Front Left)'}, // Outside hitter
      pos5: {x: 350, y: 300, label: 'Position 5 (Back Left)'}, // Libero/Defensive specialist
      pos6: {x: 450, y: 300, label: 'Position 6 (Back Center)'}, // Setter
    };

    // Generate stats
    function generateStats(position) {
      const baseStats = {
        'Setter': {attack: 70, block: 65, serve: 80, reception: 85, dig: 80, set_accuracy: 90, height: 190, value: 80},
        'Outside Hitter': {attack: 90, block: 80, serve: 85, reception: 80, dig: 75, height: 195, value: 100},
        'Middle Blocker': {attack: 85, block: 90, serve: 80, reception: 70, dig: 70, height: 205, value: 90},
        'Opposite': {attack: 95, block: 85, serve: 90, reception: 75, dig: 70, height: 200, value: 110},
        'Libero': {attack: 50, block: 50, serve: 70, reception: 95, dig: 95, height: 175, value: 70}
      };
      const stats = {...baseStats[position] || baseStats['Outside Hitter']};
      for (let key in stats) if (key !== 'height' && key !== 'set_accuracy' && key !== 'value') stats[key] += Math.floor(Math.random() * 10 - 5);
      return stats;
    }

    // Load team
    function loadTeam() {
      const savedTeam = localStorage.getItem("volleyballTeam");
      if (savedTeam) {
        team = JSON.parse(savedTeam);
      }
      updateDropdowns();
      updatePointsDisplay();
      updateCurrencyDisplay();
      updateStatsDisplay();
      updatePlayerInventory();
      updateButtonStates();
      drawCourt();
    }

    // Save team
    function saveTeam() {
      localStorage.setItem("volleyballTeam", JSON.stringify(team));
    }

    // Save team name
    function saveTeamName() {
      const teamNameInput = document.getElementById("teamName").value;
      if (teamNameInput) {
        team.name = teamNameInput;
        saveTeam();
        alert("Team name saved!");
      } else {
        alert("Please enter a team name.");
      }
    }

    // Update dropdowns
    function updateDropdowns() {
      const positions = ['pos1', 'pos2', 'pos3', 'pos4', 'pos5', 'pos6'];
      positions.forEach(pos => {
        const select = document.getElementById(pos);
        select.innerHTML = '<option value="">Select Player</option>';
        team.players.forEach((player, index) => {
          select.innerHTML += `<option value="${index}">${player.name} (${player.position})</option>`;
        });
        select.value = lineup[pos] ? team.players.findIndex(p => p.name === lineup[pos].name) : "";
      });
      drawCourt();
      updateButtonStates();
    }

    // Update lineup
    function updateLineup(position, index) {
      if (index === "") {
        delete lineup[position];
      } else {
        lineup[position] = team.players[parseInt(index)];
      }
      drawCourt();
      updateButtonStates();
    }

    // Update points
    function updatePointsDisplay() {
      document.getElementById("points").textContent = team.points;
    }

    // Update currency
    function updateCurrencyDisplay() {
      document.getElementById("currency").textContent = team.currency;
      updateButtonStates();
    }

    // Update stats
    function updateStatsDisplay() {
      const statsDiv = document.getElementById("teamStats");
      statsDiv.innerHTML = `
        <div class="stat-card">Matches: ${team.stats.matches}</div>
        <div class="stat-card">Wins: ${team.stats.wins}</div>
        <div class="stat-card">Sets Won: ${team.stats.setsWon}</div>
        <div class="stat-card">Kills: ${team.stats.kills}</div>
        <div class="stat-card">Blocks: ${team.stats.blocks}</div>
        <div class="stat-card">Aces: ${team.stats.aces}</div>
        <div class="stat-card">Digs: ${team.stats.digs}</div>
        <div class="stat-card">Errors: ${team.stats.errors}</div>
      `;
    }

    // Update player inventory
    function updatePlayerInventory() {
      const inventoryDiv = document.getElementById("playerInventory");
      inventoryDiv.innerHTML = "";
      team.players.forEach((player, index) => {
        inventoryDiv.innerHTML += `
          <div class="inventory-item">
            <span>${player.name} (${player.position}) - Value: $${player.value}</span>
            <button onclick="sellPlayer(${index})">Sell ($ ${player.value})</button>
          </div>
        `;
      });
    }

    // Sell player
    function sellPlayer(index) {
      const player = team.players[index];
      if (confirm(`Sell ${player.name} for $${player.value}?`)) {
        team.currency += player.value;
        team.players.splice(index, 1);
        // Remove from lineup if present
        for (let pos in lineup) {
          if (lineup[pos] && lineup[pos].name === player.name) {
            delete lineup[pos];
          }
        }
        saveTeam();
        updateDropdowns();
        updateCurrencyDisplay();
        updatePlayerInventory();
      }
    }

    // Update button states
    function updateButtonStates() {
      const packCosts = {
        'vnl_men': 100,
        'vnl_women': 100,
        'volleyroo_men': 80,
        'volleyroo_women': 80,
        'iran_men': 90,
        'china_men': 90,
        'china_women': 90,
        'japan_men': 95,
        'japan_women': 95
      };
      const packButtons = document.querySelectorAll(".pack-buttons button");
      packButtons.forEach(button => {
        const packType = button.textContent.split(' (')[0].toLowerCase().replace(' ', '_');
        button.disabled = team.currency < packCosts[packType];
      });

      const startMatchBtn = document.getElementById("startMatchBtn");
      const rotateTeamBtn = document.getElementById("rotateTeamBtn");
      const lineupComplete = Object.values(lineup).filter(p => p).length === 6;
      startMatchBtn.disabled = !lineupComplete;
      rotateTeamBtn.disabled = !lineupComplete;
    }

    // Open pack
    function openPack(packType, cost) {
      if (team.currency < cost) {
        alert("Not enough currency!");
        return;
      }

      if (team.players.length >= 14) {
        alert("Team is full (max 14 players).");
        return;
      }

      const availablePlayers = playerPacks[packType].filter(p => !team.players.some(existing => existing.name === p.name));
      if (availablePlayers.length === 0) {
        alert("No new players available in this pack!");
        return;
      }

      let randomPlayer = {...availablePlayers[Math.floor(Math.random() * availablePlayers.length)]};
      randomPlayer = {...randomPlayer, ...generateStats(randomPlayer.position)};
      randomPlayer.stats = { kills: 0, blocks: 0, aces: 0, digs: 0, errors: 0 };

      team.currency -= cost;
      team.players.push(randomPlayer);
      saveTeam();
      updateDropdowns();
      updateCurrencyDisplay();
      updatePlayerInventory();
      document.getElementById("packResult").innerHTML = `Added ${randomPlayer.name} (${randomPlayer.position})!`;
    }

    // Draw court
    function drawCourt() {
      const canvas = document.getElementById("courtCanvas");
      const ctx = canvas.getContext("2d");
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Draw court
      ctx.fillStyle = "#76d7c4";
      ctx.fillRect(100, 50, 600, 300);
      ctx.strokeStyle = "#000";
      ctx.lineWidth = 2;
      ctx.strokeRect(100, 50, 600, 300);
      ctx.beginPath();
      ctx.moveTo(400, 50);
      ctx.lineTo(400, 350);
      ctx.stroke();

      // Draw attack line
      ctx.beginPath();
      ctx.moveTo(100, 200);
      ctx.lineTo(700, 200);
      ctx.setLineDash([5, 5]);
      ctx.stroke();
      ctx.setLineDash([]);

      // Draw position zones and labels
      ctx.font = "12px Arial";
      const imagesLoaded = {};
      for (let key in lineupPositions) {
        const pos = lineupPositions[key];
        ctx.beginPath();
        ctx.arc(pos.x, pos.y, 20, 0, Math.PI * 2);
        ctx.fillStyle = "rgba(255,255,255,0.5)";
        ctx.fill();
        ctx.stroke();
        ctx.fillStyle = "#000";
        ctx.fillText(pos.label, pos.x - 40, pos.y - 25);
        if (lineup[key]) {
          const img = new Image();
          img.crossOrigin = "Anonymous";
          img.src = lineup[key].photo;
          imagesLoaded[key] = false;
          img.onload = () => {
            ctx.drawImage(img, pos.x - 12.5, pos.y - 12.5, 25, 25);
            imagesLoaded[key] = true;
            if (Object.values(imagesLoaded).every(loaded => loaded || !lineup[key])) {
              drawCourt(); // Redraw to ensure all images are loaded
            }
          };
          img.onerror = () => {
            img.src = 'https://via.placeholder.com/25';
            ctx.drawImage(img, pos.x - 12.5, pos.y - 12.5, 25, 25);
            imagesLoaded[key] = true;
          };
          ctx.fillText(lineup[key].name.slice(0, 10), pos.x - 30, pos.y + 25);
        }
      }
    }

    // Get lineup
    function getLineup() {
      const l = {
        pos1: lineup.pos1,
        pos2: lineup.pos2,
        pos3: lineup.pos3,
        pos4: lineup.pos4,
        pos5: lineup.pos5,
        pos6: lineup.pos6,
      };
      if (Object.values(l).filter(p => p).length < 6) {
        alert("Incomplete lineup! Select 6 players.");
        return null;
      }
      return l;
    }

    // Rotate team
    function rotateTeam() {
      const l = getLineup();
      if (!l) return;
      currentRotation = (currentRotation + 1) % 6;
      const allPlayers = [lineup.pos1, lineup.pos2, lineup.pos3, lineup.pos4, lineup.pos5, lineup.pos6].filter(p => p);
      if (allPlayers.length < 6) return;
      const temp = allPlayers.shift();
      allPlayers.push(temp);
      lineup.pos1 = allPlayers[0];
      lineup.pos2 = allPlayers[1];
      lineup.pos3 = allPlayers[2];
      lineup.pos4 = allPlayers[3];
      lineup.pos5 = allPlayers[4];
      lineup.pos6 = allPlayers[5];
      updateDropdowns();
    }

    // Generate opponent
    function generateOpponent() {
      const avgStats = team.players.reduce((acc, p) => {
        acc.attack += p.attack;
        acc.block += p.block;
        acc.serve += p.serve;
        acc.reception += p.reception;
        acc.dig += p.dig;
        return acc;
      }, {attack: 0, block: 0, serve: 0, reception: 0, dig: 0});
      for (let key in avgStats) avgStats[key] /= team.players.length;
      return {
        pos1: {set_accuracy: 85, ...avgStats},
        pos2: {...avgStats},
        pos3: {...avgStats},
        pos4: {...avgStats},
        pos5: {...avgStats},
        pos6: {...avgStats},
      };
    }

    // Play game
    function playGame() {
      const l = getLineup();
      if (!l) return;

      const opponent = generateOpponent();
      let teamSets = 0, opponentSets = 0;
      let matchStats = { team: { kills: 0, blocks: 0, aces: 0, digs: 0, errors: 0 }, opponent: { kills: 0, blocks: 0, aces: 0, digs: 0, errors: 0 } };
      let setScores = [];
      let highlightPoints = [];
      let serving = 'opponent';
      currentRotation = 0;

      for (let set = 1; set <= 5; set++) {
        const isDecidingSet = set === 5;
        const targetPoints = isDecidingSet ? 15 : 25;
        let teamPoints = 0, opponentPoints = 0;

        while ((teamPoints < targetPoints && opponentPoints < targetPoints) || Math.abs(teamPoints - opponentPoints) < 2) {
          const pointResult = simulatePoint(l, opponent, matchStats, serving, 0);
          if (pointResult.winner === 'team') {
            if (serving === 'opponent') rotateTeam();
            serving = 'team';
            teamPoints++;
          } else {
            if (serving === 'team') opponentRotate(opponent);
            serving = 'opponent';
            opponentPoints++;
          }
          if (highlightPoints.length < 3) highlightPoints.push(pointResult);
        }

        setScores.push(`${teamPoints}-${opponentPoints}`);
        if (teamPoints > opponentPoints) teamSets++;
        else opponentSets++;
        team.stats.setsWon += teamPoints > opponentPoints ? 1 : 0;

        if (teamSets >= 3 || opponentSets >= 3) break;
      }

      team.stats.matches++;
      if (teamSets > opponentSets) {
        team.stats.wins++;
        team.points += 3;
        team.currency += 200;
      } else if (teamSets === opponentSets) {
        team.points += 1;
        team.currency += 100;
      } else {
        team.points = Math.max(0, team.points - 1);
        team.currency += 50;
      }
      team.stats.kills += matchStats.team.kills;
      team.stats.blocks += matchStats.team.blocks;
      team.stats.aces += matchStats.team.aces;
      team.stats.digs += matchStats.team.digs;
      team.stats.errors += matchStats.team.errors;

      saveTeam();
      updatePointsDisplay();
      updateCurrencyDisplay();
      updateStatsDisplay();
      updatePlayerInventory();

      let resultText = `Match Result: ${team.name} ${teamSets} - ${opponentSets} Opponent<br>Sets: ${setScores.join(', ')}<br>`;
      resultText += `Stats - Kills: ${matchStats.team.kills}, Blocks: ${matchStats.team.blocks}, Aces: ${matchStats.team.aces}, Digs: ${matchStats.team.digs}, Errors: ${matchStats.team.errors}<br>`;
      resultText += `Currency Earned: $${teamSets > opponentSets ? 200 : teamSets === opponentSets ? 100 : 50}`;
      document.getElementById("gameResult").innerHTML = resultText;

      animatePoints(highlightPoints);
    }

    // Opponent rotation
    function opponentRotate(opponent) {
      const allPlayers = [opponent.pos1, opponent.pos2, opponent.pos3, opponent.pos4, opponent.pos5, opponent.pos6];
      const temp = allPlayers.shift();
      allPlayers.push(temp);
      opponent.pos1 = allPlayers[0];
      opponent.pos2 = allPlayers[1];
      opponent.pos3 = allPlayers[2];
      opponent.pos4 = allPlayers[3];
      opponent.pos5 = allPlayers[4];
      opponent.pos6 = allPlayers[5];
    }

    // Simulate point
    function simulatePoint(lineup, opponent, matchStats, serving, depth) {
      if (depth > 3) {
        return {winner: Math.random() < 0.5 ? 'team' : 'opponent', actions: [{action: 'end', outcome: 'forced'}]};
      }
      const actions = [];
      const servingTeam = serving;
      const server = servingTeam === 'team' ? lineup.pos1 : opponent.pos1;
      const receiver = servingTeam === 'team' ? opponent.pos5 : lineup.pos5;

      actions.push({action: 'serve', from: server, to: receiver, fromPos: servingTeam === 'team' ? lineupPositions.pos1 : {x: 150, y: 300}});

      if (Math.random() < server.serve / 100 * 0.1) {
        matchStats[servingTeam].aces++;
        actions[actions.length - 1].outcome = 'ace';
        return {winner: servingTeam, actions};
      } else if (Math.random() < 0.05) {
        matchStats[servingTeam].errors++;
        actions[actions.length - 1].outcome = 'error';
        return {winner: servingTeam === 'team' ? 'opponent' : 'team', actions};
      }

      if (Math.random() > receiver.reception / 100) {
        matchStats[servingTeam === 'team' ? 'opponent' : 'team'].errors++;
        actions.push({action: 'reception', outcome: 'error', fromPos: servingTeam === 'team' ? {x: 200, y: 200} : lineupPositions.pos5});
        return {winner: servingTeam, actions};
      }
      actions.push({action: 'reception', outcome: 'success', fromPos: servingTeam === 'team' ? {x: 200, y: 200} : lineupPositions.pos5});

      const settingTeam = servingTeam === 'team' ? 'opponent' : 'team';
      const setter = settingTeam === 'team' ? (lineup.pos6.set_accuracy ? lineup.pos6 : lineup.pos3) : (opponent.pos6.set_accuracy ? opponent.pos6 : opponent.pos3);
      actions.push({action: 'set', from: receiver, to: setter, fromPos: settingTeam === 'team' ? lineupPositions.pos6 : {x: 300, y: 300}});
      const goodSet = Math.random() < (setter.set_accuracy || 85) / 100;

      const rand = Math.random();
      let attacker, blocker, attackPos, blockPos;
      if (rand < 0.5) {
        attacker = settingTeam === 'team' ? lineup.pos4 : opponent.pos4;
        blocker = settingTeam === 'team' ? opponent.pos3 : lineup.pos3;
        attackPos = settingTeam === 'team' ? lineupPositions.pos4 : {x: 350, y: 100};
        blockPos = settingTeam === 'team' ? {x: 300, y: 200} : lineupPositions.pos3;
      } else if (rand < 0.8) {
        attacker = settingTeam === 'team' ? lineup.pos2 : opponent.pos2;
        blocker = settingTeam === 'team' ? opponent.pos3 : lineup.pos3;
        attackPos = settingTeam === 'team' ? lineupPositions.pos2 : {x: 450, y: 100};
        blockPos = settingTeam === 'team' ? {x: 300, y: 200} : lineupPositions.pos3;
      } else {
        attacker = settingTeam === 'team' ? lineup.pos3 : opponent.pos3;
        blocker = settingTeam === 'team' ? opponent.pos2 : lineup.pos2;
        attackPos = settingTeam === 'team' ? lineupPositions.pos3 : {x: 350, y: 100};
        blockPos = settingTeam === 'team' ? {x: 300, y: 100} : lineupPositions.pos2;
      }

      actions.push({action: 'attack', from: setter, to: attacker, blocker, fromPos: attackPos, blockPos});

      let attackChance = attacker.attack / 100 * (goodSet ? 1 : 0.7);
      if (Math.random() < attackChance) {
        matchStats[settingTeam].kills++;
        actions[actions.length - 1].outcome = 'kill';
        return {winner: settingTeam, actions};
      } else if (Math.random() < blocker.block / 200) {
        matchStats[settingTeam === 'team' ? 'opponent' : 'team'].blocks++;
        actions[actions.length - 1].outcome = 'block';
        return {winner: settingTeam === 'team' ? 'opponent' : 'team', actions};
      } else if (Math.random() < 0.1) {
        matchStats[settingTeam].errors++;
        actions[actions.length - 1].outcome = 'error';
        return {winner: settingTeam === 'team' ? 'opponent' : 'team', actions};
      }

      const digger = settingTeam === 'team' ? opponent.pos5 : lineup.pos5;
      actions.push({action: 'dig', from: attacker, to: digger, fromPos: settingTeam === 'team' ? {x: 200, y: 300} : lineupPositions.pos5});
      if (Math.random() < digger.dig / 100) {
        matchStats[settingTeam === 'team' ? 'opponent' : 'team'].digs++;
        actions[actions.length - 1].outcome = 'success';
        const counterResult = simulatePoint(lineup, opponent, matchStats, serving, depth + 1);
        counterResult.actions.forEach(a => actions.push(a));
        return {winner: counterResult.winner, actions};
      } else {
        actions[actions.length - 1].outcome = 'fail';
        return {winner: settingTeam, actions};
      }
    }

    // Animate multiple points
    function animatePoints(points) {
      const canvas = document.getElementById("courtCanvas");
      const ctx = canvas.getContext("2d");
      let pointIndex = 0;
      let currentAction = 0;
      let step = 0;
      let ballX = 650, ballY = 300;

      function animateStep() {
        drawCourt();

        ctx.beginPath();
        ctx.arc(ballX, ballY, 10, 0, Math.PI * 2);
        ctx.fillStyle = "#ffcc00";
        ctx.fill();

        if (pointIndex < points.length) {
          const actions = points[pointIndex].actions;
          if (currentAction < actions.length) {
            const act = actions[currentAction];
            let targetX, targetY;
            if (act.action === 'serve') {
              targetX = act.fromPos.x === 650 ? 200 : 600;
              targetY = 200;
            } else if (act.action === 'reception') {
              targetX = act.fromPos.x;
              targetY = act.fromPos.y;
            } else if (act.action === 'set') {
              targetX = act.fromPos.x;
              targetY = act.fromPos.y;
            } else if (act.action === 'attack') {
              targetX = act.blockPos.x;
              targetY = act.blockPos.y;
            } else if (act.action === 'dig') {
              targetX = act.fromPos.x;
              targetY = act.fromPos.y;
            }

            ballX += (targetX - ballX) * 0.1;
            ballY += (targetY - ballY) * 0.1 + Math.sin(step / 10) * 2;

            step++;
            if (Math.abs(ballX - targetX) < 5 && Math.abs(ballY - targetY) < 5) {
              currentAction++;
              step = 0;
              if (act.outcome === 'ace' || act.outcome === 'kill' || act.outcome === 'error' || act.outcome === 'block' || act.outcome === 'fail') {
                currentAction = 0;
                pointIndex++;
                ballX = points[pointIndex] && points[pointIndex].actions[0].fromPos.x === 650 ? 650 : 150;
                ballY = 300;
              }
            }
            requestAnimationFrame(animateStep);
          } else {
            pointIndex++;
            currentAction = 0;
            ballX = points[pointIndex] && points[pointIndex].actions[0].fromPos.x === 650 ? 650 : 150;
            ballY = 300;
            requestAnimationFrame(animateStep);
          }
        }
      }
      animateStep();
    }

    // Initialize
    loadTeam();
  </script>
</body>
</html>
